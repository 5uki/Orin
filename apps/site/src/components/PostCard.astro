---
/**
 * PostCard Component
 * 
 * Displays a blog post card with title, excerpt, metadata, and optional pinned indicator.
 * Features card/floating style with hover effects.
 * 
 * Requirements: 2.5, 2.7, 5.4, 12.1, 12.3
 */
import { formatChineseDate } from '@/utils/date'
import { groupToSlug } from '@/utils/group'
import { tagToSlug } from '@/utils/tag'

interface Props {
  slug: string
  title: string
  date: Date
  updatedDate?: Date
  summary?: string
  tags?: string[]
  isPinned?: boolean
  group?: string
}

const { slug, title, date, updatedDate, summary, tags = [], isPinned = false, group } = Astro.props

const formattedDate = formatChineseDate(date)
const formattedUpdatedDate = updatedDate ? formatChineseDate(updatedDate) : null
const showUpdatedDate = updatedDate && updatedDate.getTime() !== date.getTime()

const postUrl = `/posts/${slug}`
const groupUrl = group ? `/groups/${groupToSlug(group)}` : null
---

<article class:list={['post-card', { pinned: isPinned }]} data-post-slug={slug}>
  {/* 置顶标识 */}
  {isPinned && (
    <div class="pinned-badge">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
        <path d="M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"/>
      </svg>
      <span>置顶</span>
    </div>
  )}

  <a href={postUrl} class="post-link">
    <h2 class="post-title">{title}</h2>
  </a>
  
  <div class="post-meta">
    {/* 发布日期 */}
    <time datetime={date.toISOString()} class="publish-date">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      {formattedDate}
    </time>

    {/* 更新日期 */}
    {showUpdatedDate && (
      <time datetime={updatedDate!.toISOString()} class="updated-date">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6"></path>
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
        </svg>
        更新于 {formattedUpdatedDate}
      </time>
    )}

    {/* 分组 */}
    {group && groupUrl && (
      <a href={groupUrl} class="post-group">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
        {group}
      </a>
    )}

    {/* 标签 */}
    {tags.length > 0 && (
      <div class="post-tags">
        {tags.slice(0, 3).map((tag) => (
          <a href={`/tags/${tagToSlug(tag)}`} class="tag">
            {tag}
          </a>
        ))}
      </div>
    )}
  </div>
  
  {summary && (
    <p class="post-summary">{summary}</p>
  )}
</article>

<style>
  .post-card {
    position: relative;
    padding: var(--space-5);
    background-color: var(--color-bg-secondary);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
  }

  .post-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  /* 置顶卡片样式 */
  .post-card.pinned {
    border-left: 3px solid var(--color-accent);
    background: linear-gradient(
      135deg,
      var(--color-accent-light) 0%,
      var(--color-bg-secondary) 100%
    );
  }

  .pinned-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    color: var(--color-accent);
    background-color: var(--color-accent-light);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    margin-bottom: var(--space-3);
  }

  .post-link {
    text-decoration: none;
    display: block;
  }

  .post-title {
    font-size: var(--text-xl);
    font-weight: var(--font-semibold);
    color: var(--color-fg);
    margin: 0;
    line-height: var(--leading-snug);
    transition: color var(--transition-fast);
  }

  .post-link:hover .post-title {
    color: var(--color-accent);
  }

  .post-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-3);
    margin-top: var(--space-3);
    font-size: var(--text-sm);
    color: var(--color-fg-muted);
  }

  .publish-date,
  .updated-date {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
  }

  .updated-date {
    color: var(--color-fg-muted);
    font-style: italic;
  }

  .post-group {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-xs);
    color: var(--color-fg-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .post-group:hover {
    color: var(--color-accent);
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-left: auto;
  }

  .tag {
    font-size: var(--text-xs);
    color: var(--color-accent);
    background-color: var(--color-accent-light);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    text-decoration: none;
    transition: background-color var(--transition-fast), color var(--transition-fast);
  }

  .tag:hover {
    background-color: var(--color-accent);
    color: white;
  }

  .post-summary {
    margin-top: var(--space-3);
    font-size: var(--text-base);
    color: var(--color-fg-secondary);
    line-height: var(--leading-relaxed);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* 响应式调整 */
  @media (max-width: 768px) {
    .post-card {
      padding: var(--space-4);
    }

    .post-title {
      font-size: var(--text-lg);
    }

    .post-meta {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-2);
    }

    .post-tags {
      margin-left: 0;
    }
  }
</style>
